name: lint

on:
    pull_request:
    push:
        branches: [main]

jobs:
    markdown-lint:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Install markdownlint-cli
              run: npm install -g markdownlint-cli

            - name: Lint markdown
              run: make lint-md

    sync-drift:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Regenerate copilot-instructions.md
              run: make sync-copilot

            - name: Check for drift
              run: |
                  if ! git diff --exit-code .github/copilot-instructions.md; then
                    echo "::error::copilot-instructions.md is out of sync with instructions.md. Run 'make sync-copilot' and commit."
                    exit 1
                  fi
